# 정규 표현식의 중첩 그룹

## 중첩 그룹의 필요성
복잡한 데이터를 처리할 때는 여러 계층의 정보를 동시에 추출해야 하는 경우가 많습니다. 정규 표현식에서는 그룹 안에 또 다른 그룹을 중첩하여 이러한 계층적 데이터 추출을 가능하게 합니다.

## 중첩 그룹의 기본 개념
정규 표현식에서 중첩 그룹은 소괄호 안에 다른 소괄호를 포함하는 구조입니다.

### 중첩 그룹 문법
- **((패턴1)(패턴2))**: 바깥쪽 그룹과 안쪽 그룹을 모두 캡처
- 그룹은 왼쪽에서 오른쪽으로 열린 괄호 순서대로 번호가 매겨집니다
- 가장 바깥쪽 그룹이 첫 번째 그룹, 그 안의 첫 번째 그룹이 두 번째 그룹... 식으로 번호가 지정됩니다

## 중첩 그룹 번호 매기기
중첩 그룹의 번호는 왼쪽 괄호가 나타나는 순서에 따라 결정됩니다.

### 예시: `(a(b(c)d)e)`
이 패턴에서 그룹 번호는 다음과 같습니다:
1. `(a(b(c)d)e)` - 전체 그룹 (a, b, c, d, e)
2. `(b(c)d)` - 두 번째 그룹 (b, c, d)
3. `(c)` - 세 번째 그룹 (c)

## 실제 활용 사례

### 파일 이름과 번호 추출
- **^(IMG(\d+))\.png$**: 이미지 파일에서 파일 이름과 번호를 추출
  - 그룹 1: `IMG123` (전체 파일 이름)
  - 그룹 2: `123` (사진 번호)

### 날짜 데이터 추출
- **((19|20)(\d{2}))-(\d{2})-(\d{2})**: 날짜에서 전체 연도와 세기, 년, 월, 일 추출
  - 그룹 1: `2023` (전체 연도)
  - 그룹 2: `20` (세기)
  - 그룹 3: `23` (년)
  - 그룹 4: `11` (월)
  - 그룹 5: `15` (일)

### URL 구성요소 추출
- **(https?://([\w-]+\.)+[\w-]+(/[\w-./?%&=]*)?)**: URL에서 전체 URL과 도메인 추출
  - 그룹 1: `https://example.com/path` (전체 URL)
  - 그룹 2: `example.` (도메인 부분)
  - 그룹 3: `/path` (경로 부분)

## 중첩 그룹과 역참조
중첩 그룹은 역참조와 함께 사용하여 더 강력한 패턴 매칭을 구현할 수 있습니다.

### 예시: HTML 태그 매칭
- **<(([a-z]+)([^>]*))>(.*?)</\2>**: HTML 태그의 여러 부분 캡처
  - 그룹 1: `h1 class="title"` (태그 이름과 속성 전체)
  - 그룹 2: `h1` (태그 이름)
  - 그룹 3: ` class="title"` (태그 속성)
  - 그룹 4: `Hello, World!` (태그 내용)
  - 그리고 `</\2>`에서는 두 번째 그룹(태그 이름)을 참조하여 동일한 닫는 태그를 매칭

## 비캡처 그룹과 중첩 그룹
중첩 그룹을 사용할 때 모든 그룹을 캡처할 필요가 없다면, 일부 그룹은 비캡처 그룹으로 만들 수 있습니다.

### 예시: 비캡처 그룹 활용
- **((?:19|20)(\d{2}))-(\d{2})-(\d{2})**: 세기 부분(19|20)은 캡처하지 않고 년도만 캡처
  - 그룹 1: `2023` (전체 연도)
  - 그룹 2: `23` (년)
  - 그룹 3: `11` (월)
  - 그룹 4: `15` (일)

## 중첩 그룹의 실용적 활용 사례

### 로그 데이터 파싱
- **(\[(\d{4}-\d{2}-\d{2}) (\d{2}:\d{2}:\d{2})\] (INFO|ERROR|WARNING): (.*))**: 로그 메시지에서 날짜, 시간, 로그 레벨, 내용 추출
  - 그룹 1: 전체 로그 라인
  - 그룹 2: 날짜
  - 그룹 3: 시간
  - 그룹 4: 로그 레벨
  - 그룹 5: 메시지 내용

### 이메일 구문 분석
- **(([\w.-]+)@([\w-]+\.([\w-]+)))**: 이메일 주소의 다양한 부분 추출
  - 그룹 1: 전체 이메일 주소
  - 그룹 2: 사용자 이름
  - 그룹 3: 도메인 (TLD 포함)
  - 그룹 4: TLD (최상위 도메인)

### 프로그래밍 언어에서 함수 정의 추출
- **(function\s+([\w_]+)\s*\((.*?)\)\s*{)**: JavaScript 함수 정의 추출
  - 그룹 1: 전체 함수 선언부
  - 그룹 2: 함수 이름
  - 그룹 3: 매개변수

## 중첩 그룹 디버깅 팁
중첩 그룹은 복잡해질 수 있으므로, 디버깅에 도움이 되는 팁은 다음과 같습니다:

1. **점진적 구축**: 가장 안쪽 그룹부터 시작하여 바깥쪽으로 패턴을 확장해 나갑니다
2. **그룹 수 최소화**: 필요한 정보만 캡처하도록 그룹을 설계합니다
3. **비캡처 그룹 활용**: 캡처가 필요하지 않은 그룹은 `(?:패턴)` 형식을 사용합니다
4. **명확한 주석 추가**: 복잡한 패턴을 만들 때는 각 그룹의 목적을 주석으로 기록합니다

## 실습 예제
다음 패턴을 작성하고 각 그룹이 어떤 부분을 캡처하는지 확인해 보세요:

1. 전체 날짜와 연도만 캡처하는 패턴:
   - `((19|20)\d{2})[-.\/](0[1-9]|1[0-2])[-.\/](0[1-9]|[12][0-9]|3[01])`
   - 예: "2023-11-15"에서 그룹 1: "2023", 그룹 2: "20"

2. HTML 이미지 태그에서 소스 URL과 파일 이름 추출:
   - `<img\s+src="((https?:\/\/[\w\.\/]+\/)([^\/]+\.(jpg|png|gif)))"`
   - 예: `<img src="https://example.com/images/photo.jpg">`에서
     - 그룹 1: "https://example.com/images/photo.jpg"
     - 그룹 2: "https://example.com/images/"
     - 그룹 3: "photo.jpg"
     - 그룹 4: "jpg"

## 주의사항
1. 중첩 그룹이 너무 많으면 가독성과 유지보수성이 떨어집니다
2. 모든 정규 표현식 엔진이 동일한 방식으로 중첩 그룹을 처리하지 않을 수 있습니다
3. 그룹 번호가 많아지면 혼란이 생길 수 있으므로 명명된 캡처 그룹(Named Capture Groups)을 사용하는 것이 좋습니다 (지원하는 엔진에서)
